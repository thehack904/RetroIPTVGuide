{% extends "base.html" %}
{% block title %}Manage Users â€” IPTV Guide{% endblock %}

{% block page_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/manage_users.css') }}">
{% endblock %}

{% block content %}
<div class="container-manage-users">
  <div class="box">
    <h2>Manage Users</h2>

    <form method="POST" class="add-user-form">
      <h3>Add New User</h3>
      <input type="hidden" name="action" value="add">
      <div class="form-row"><input type="text" name="username" placeholder="Username" required></div>
      <div class="form-row"><input type="password" name="password" placeholder="Password" required></div>
      <div class="form-row"><button class="btn add" type="submit">Add User</button></div>
    </form>

    <h3>Existing Users</h3>
    <div class="table-wrap">
      <table class="users-table">
          <thead>
            <tr><th>Username</th><th>Actions</th></tr>
          </thead>
          <tbody>
            {% for user in users %}
            <tr>
              <td>{{ user }}</td>
              <td class="actions">
                <form method="POST" class="inline-form">
                  <input type="hidden" name="username" value="{{ user }}">
                  <input type="hidden" name="action" value="delete">
                  <button class="btn danger" type="submit">Delete</button>
                </form>
                <form method="POST" class="inline-form">
                  <input type="hidden" name="username" value="{{ user }}">
                  <input type="hidden" name="action" value="signout">
                  <button class="btn warn" type="submit">Sign Out All</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
      </table>
    </div>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="flash-messages">
          {% for msg in messages %}
            <p class="flash">{{ msg }}</p>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
  </div>
</div>
{% endblock %}

{% block scripts_extra %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  // Apply saved theme (base.html provides setTheme/updateClock)
  const saved = localStorage.getItem("theme") || "dark";
  if (typeof setTheme === 'function') setTheme(saved);
  if (typeof updateClock === 'function') updateClock();
});
</script>
{% endblock %}
